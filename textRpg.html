<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_eight@1.0/DOSGothic.woff">
<title>Document</title>
<style>
  @font-face {
    font-family: 'DOSGothic';
    src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_eight@1.0/DOSGothic.woff') format('woff');
    font-weight: normal;
    font-style: normal;
}
  body {
    font-family: 'DOSGothic';
    font-weight: normal;
    font-style: normal;
    font-size: 20px;
    display: flex;
    background-color: black;
    color: white;
    justify-content: center;
    align-items: center;
  }
  
  #wrap {
    background-color: rgb(0, 0, 0);
    padding: 10px;
    border-style: inset;
    width: 500px;
    height: 400px;
    transition: padding-left .1s;
  }
  
  form {
    margin-bottom: 30px;
  }

  input {
    margin-bottom: 10px;
    font-family: 'DOSGothic';
    font-size: 20px;
    width: 300px;
    background-color: black;
    color: white;
    border-style: none;
    outline: none;
    padding: 5px;
  }

  button {
    display: block;
    font-family: 'DOSGothic';
    font-size: 20px;
    background-color: black;
    color:white;
    border-style: none;
  }
  /* button:hover {
    background-color: white;
    color: black;
  }

  #start_button {
    background-color: black;
    color: white;
  } */

  #hero_hp {
    transition: .5s;
  }

  #monster_hp {
    transition: .5s;
  }
</style>
</head>
<body>
<div id="wrap">
  <form id="start_screen">
    <label>><input id="name_input" placeholder="주인공 이름을 입력하세요!"></label>
    <button id="start_button">start</button>
  </form>
  <div id="screen">
    <div id="hero_stat">
      <span id="hero_name"></span>
      <span id="hero_level"></span>
      <span id="hero_hp"></span>
      <span id="hero_xp"></span>
      <span id="hero_att"></span>
    </div>
    <form id="game_menu" style="display: none;">
      <div id="menu_1">1. 모험</div>
      <div id="menu_2">2. 휴식</div>
      <div id="menu_3">3. 종료</div>
      <label>><input id="menu_input"></label>
      <button id="game_menu_button">입력</button>
    </form>
    <form id="battle_menu" style="display: none;">
      <div id="menu_1">1. 공격</div>
      <div id="menu_2">2. 회복</div>
      <div id="menu_3">3. 도망</div>
      <label>><input id="battle_input"></label>
      <button id="battle_menu_button">입력</button>
    </form>
    <div id="message"></div>
    <div id="monster_stat">
      <span id="monster_name"></span>
      <span id="monster_level"></span>
      <span id="monster_hp"></span>
      <span id="monster_att"></span>
    </div>
  </div>
</div>
<script>
  const $wrap = document.querySelector('#wrap');
  const $startButton = document.querySelector('#start_button');
  const $gameMenuButton = document.querySelector('#game_menu_button');
  const $battleMenuButton = document.querySelector('#battle_menu_button');
  const $startScreen = document.querySelector('#start_screen');
  const $gameMenu = document.querySelector('#game_menu');
  const $battleMenu = document.querySelector('#battle_menu');
  const $heroName = document.querySelector('#hero_name');
  const $heroLevel = document.querySelector('#hero_level');
  const $heroHp = document.querySelector('#hero_hp');
  const $heroXp = document.querySelector('#hero_xp');
  const $heroAtt = document.querySelector('#hero_att');
  const $monsterName = document.querySelector('#monster_name');
  const $monsterLevel = document.querySelector('#monster_level');
  const $monsterHp = document.querySelector('#monster_hp');
  const $monsterAtt = document.querySelector('#monster_att');
  const $message = document.querySelector('#message');
  let EffectIntervalId;

  class Game {
    constructor(name) {
      this.monster = null;
      this.hero = null;
      this.monsterList = [
        { name: '슬라임', hp: 25, maxHp: 25, att: 10, xp: 10 },
        // { name: '슬라임', hp: 25, maxHp: 25, att: 10, xp: 10 },
        // { name: '슬라임', hp: 25, maxHp: 25, att: 10, xp: 10 },
        // { name: '슬라임', hp: 25, maxHp: 25, att: 10, xp: 10 },
        // { name: '스켈레톤', hp: 50, maxHp: 50, att: 15, xp: 20 },
        // { name: '스켈레톤', hp: 50, maxHp: 50, att: 15, xp: 20 },
        { name: '스켈레톤', hp: 50, maxHp: 50, att: 15, xp: 20 },
        { name: '마왕', hp: 150, maxHp: 150, att: 35, xp: 50 },
      ];
      this.start(name);
    }
    start(name) {
      $gameMenu.addEventListener('submit', this.onGameMenuInput);
      $battleMenu.addEventListener('submit', this.onBattleMenuInput);
      this.changeScreen('game');
      this.hero = new Hero(this, name);
      this.effect = new Effect();
      this.updateHeroStat();
    }
    changeScreen(screen) {
      if (screen === 'start') {
        $startScreen.style.display = 'block';
        $gameMenu.style.display = 'none';
        $battleMenu.style.display = 'none';
      } else if (screen === 'game') {
        $startScreen.style.display = 'none';
        $gameMenu.style.display = 'block';
        $battleMenu.style.display = 'none';
        // setTimeout(() => {
        //   this.showMessage(`자, 무얼 하지?`)
        // })
      } else if (screen === 'battle') {
        $startScreen.style.display = 'none';
        $gameMenu.style.display = 'none';
        $battleMenu.style.display = 'block';
      }
    }
    onGameMenuInput = () => {
      event.preventDefault();
      const input = event.target['menu_input'].value;
      this.updateHeroStat();
      this.updateMonsterStat();
      if (input === '1') { // 1.모험
        this.effect.eventEffect();
        this.generatorMonster();
        this.updateMonsterStat();
        this.showMessage(`${this.monster.name} 을(를) 발견했다! 어쩌지?`)
        this.changeScreen('battle');
        EffectIntervalId = setInterval(this.effect.eventEffect, 80);
        setTimeout(() => {
          clearInterval(EffectIntervalId);
        }, 400)
      } else if (input === '2') { // 2.휴식
        this.hero.hp = this.hero.maxHp;
        this.effect.healingSelfEffect();
        this.showMessage(`휴식으로 체력이 모두 회복되었다!`)
        this.updateHeroStat();
        setTimeout(() => {
          this.changeScreen('game');
        }, 1000)
      } else if (input === '3') { // 3.종료
        this.quit();
        this.showMessage();
      }
    }
    onBattleMenuInput = () => {
      event.preventDefault();
      const input = event.target['battle_input'].value;
      if (input === '1') { // 1.공격
        const { hero, monster } = this;
        hero.attack(monster);
        monster.attack(hero);
        if (hero.hp <= 0) {
          this.effect.dyingEffect();
          this.showMessage(`당신은 ${monster.name} 에게 사망하였습니다. 잠시 뒤 메인화면으로 나갑니다`)
          setTimeout(() => {
            this.showMessage(`${hero.lev} 레벨에서 전사. 새 주인공을 생성하세요.`)
            this.changeScreen('start');
            this.quit();
          },6000)
        } else if (monster.hp <= 0) {
          this.showMessage(`몬스터를 잡아 ${monster.xp} 경험치를 얻었다`)
          hero.getXp(monster.xp);
          this.monster = null;
          this.changeScreen('game');
        } else {
          this.effect.battleEffect();
          this.showMessage(`나의 공격으로 ${this.hero.att}의 데미지를 주고 ${this.monster.att}의 데미지를 받았다!`)
        }
        this.updateHeroStat();
        this.updateMonsterStat();
      } else if (input === '2') { // 2.회복
        const { hero, monster } = this;
        hero.heal(monster);
        this.effect.healingSelfEffect();
        this.showMessage(`체력을 소량 회복했지만 적의 기습에 당했다!`)
        this.updateHeroStat();
      } else if (input === '3') { // 3.도망
        this.showMessage(`${this.monster.name}으로 부터 가까스러 도망쳤다!`)
        this.monster = null;
        this.updateMonsterStat();
        this.changeScreen('game');
      }
    }
    quit() {
      this.hero = null;
      this.monster = null;
      this.updateHeroStat();
      this.updateMonsterStat();
      $gameMenu.removeEventListener('submit', this.onGameMenuInput);
      $battleMenu.removeEventListener('submit', this.onBattleMenuInput);
      this.changeScreen('start');
      game = null;
    }
    generatorMonster = () => {
      const randomMonster = this.monsterList[
        Math.floor(Math.random() * this.monsterList.length)
      ]
      this.monster = new Monster(
        this,
        randomMonster.name,
        randomMonster.hp,
        randomMonster.att,
        randomMonster.xp,
      )
    }
    updateHeroStat() {
      const { hero } = this;
      if (hero === null) {
        $heroName.textContent = '';
        $heroLevel.textContent = '';
        $heroHp.textContent = '';
        $heroXp.textContent = '';
        $heroAtt.textContent = '';
        return;
      }
      $heroName.textContent = hero.name;
      $heroLevel.textContent = `${hero.lev}Level`;
      $heroHp.textContent = `HP:${hero.hp}/${hero.maxHp}`;
      $heroXp.textContent = `XP:${hero.xp}/${hero.lev * 15}`;
      $heroAtt.textContent = `ATT:${hero.att}`;
    }
    updateMonsterStat() {
      const { monster } = this;
      if (monster === null) {
        $monsterName.textContent = '';
        $monsterHp.textContent = '';
        $monsterAtt.textContent = '';
        return;
      }
      $monsterName.textContent = monster.name;
      $monsterHp.textContent = `HP : ${monster.hp}/${monster.maxHp}`;
      $monsterAtt.textContent = `ATT : ${monster.att}`;
    }
    showMessage(text) {
      $message.textContent = text;
    }
  }
  class Effect {
    eventEffect = () => {
      document.body.style.backgroundColor = 'white';
      $wrap.style.paddingLeft = '40px';
      this.returnScreen();
    }
    battleEffect = () => {
      document.body.style.backgroundColor = 'red';
      $wrap.style.paddingLeft = '40px';
      $heroHp.style.backgroundColor = 'red';
      $monsterHp.style.backgroundColor = 'red';
      setTimeout(() => {
        $heroHp.style.backgroundColor = 'black';
        $monsterHp.style.backgroundColor = 'black';
      }, 1000)
      this.returnScreen();
    }
    healingSelfEffect = () => {
      $heroHp.style.backgroundColor = 'rgb(12, 146, 0)';
      $heroHp.style.transition = '.5s';
      setTimeout(() => {
        $heroHp.style.backgroundColor = 'black';
      }, 500);
      setTimeout(() => {
        $heroHp.style.transition = 'none';
      }, 1000)
    }
    dyingEffect = () => {
      document.body.style.backgroundColor = 'red';
      document.body.style.transition = '3s'
      setTimeout(() => {
        document.body.style.backgroundColor = 'black';
      }, 3000);
      setTimeout(() => {
        document.body.style.transition = 'none';
      }, 6000);
    }
    levelUpEffect = () => {
      $heroLevel.style.backgroundColor = 'white'
      
      $heroLevel.style.transition = '.5s'
      setTimeout(() => {
        $heroLevel.style.backgroundColor = 'black';
      }, 500);
      setTimeout(() => {
        $heroLevel.style.transition = 'none';
      }, 1000)
    }
    returnScreen = () => {
      setTimeout(() => {
        document.body.style.backgroundColor = 'black';
        $wrap.style.paddingLeft = '0';
      }, 30)
    }
  }
  class Unit {
    constructor(game, name, hp, att, xp) {
      this.game = game;
      this.name = name;
      this.maxHp = hp;
      this.hp = hp;
      this.xp = xp;
      this.att = att;
    }
    attack(target) {
      target.hp -= this.att;
    }
  }

  class Hero extends Unit {
    constructor(game, name) {
      super(game, name, 100, 10, 0);
      this.lev = 1;
    }
    heal(monster) {
      this.hp = Math.min(this.maxHp, this.hp + 20);
      this.hp -= monster.att;
    }
    getXp(xp) {
      this.xp += xp;
      if (this.xp >= this.lev * 15) {// 경험치를 다 채우면
        this.effect = new Effect();
        this.effect.levelUpEffect();
        this.xp -= this.lev * 15;
        this.lev += 1;
        this.maxHp += 5;
        this.att += 5;
        this.hp = this.maxHp;
        this.game.showMessage(`레벨업! 레벨 ${this.lev}`)
      }
    }
  }
  
  class Monster extends Unit {
    constructor(game, name, hp, att, xp) {
      super(game, name, hp, att, xp);
    }
  }
  


  let game = null;
  $startScreen.addEventListener('submit', (event) => {
    event.preventDefault();
    const name = event.target['name_input'].value;
    game = new Game(name);
  });
  $startButton.addEventListener('mouseover', () => {
    $startButton.style.borderBottom = '4px solid white';
  })
  $startButton.addEventListener('mouseleave', () => {
    $startButton.style.borderBottom = 'none';
  })
  $gameMenuButton.addEventListener('mouseover', () => {
    $gameMenuButton.style.borderBottom = '4px solid white';
  })
  $gameMenuButton.addEventListener('mouseleave', () => {
    $gameMenuButton.style.borderBottom = 'none';
  })
  $battleMenuButton.addEventListener('mouseover', () => {
    $battleMenuButton.style.borderBottom = '4px solid white';
  })
  $battleMenuButton.addEventListener('mouseleave', () => {
    $battleMenuButton.style.borderBottom = 'none';
  })
</script>
</body>
</html>
